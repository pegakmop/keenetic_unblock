# Keenetic Unblock

## Кратко

Небольшой скрипт для возможности перенаправления трафика определенных до/от хостов через
настроенные [подключения](https://help.keenetic.com/hc/ru/articles/360000455900), в том числе
и [другие](https://help.keenetic.com/hc/ru/articles/360000599019), в т.ч. VPN.

## Для чего

Для более точной настройки маршрутизации трафика, особенно если отправка всего трафика через VPN по каким-либо причинам
не подходит.

В отличие от аналогичных решений ([раз](https://keenetic-gi.ga/2018/01/16/selective-routing.html)
, [два](https://github.com/Kyrie1965/unblock_keenetic), [три](https://github.com/MonakhovK/tor-proxy-keenetic)), решение
использует родной резолвер роутера, а не сторонний `dnsmasq`, так что функциональность
встроенных [интернет-фильтров](https://help.keenetic.com/hc/ru/articles/360000582119) сохраняется.

## Требования и зависимости

* KeeneticOS (Проверялось только на моём Giga KN-1011 v.3.7.3)
* Установленный [OPKG](https://help.keenetic.com/hc/ru/articles/360000948719)
* Установленный [Entware](https://forum.keenetic.com/topic/4299-entware/)
* Пакеты `busybox`, `curl` и `cron`

## Установка и работа

* Подключитесь к роутеру по ssh и зайдите в shell
* Выполните `curl -s https://raw.githubusercontent.com/pegakmop/keenetic_unblock/master/install.sh | sh`
  * Можно также скачать скрипт и исправить директорию для хранения файлов или интерфейс подключения на подходящий вам --
    в моём случае это Wireguard0
* Добавьте нужные домены для перенаправления в `/storage/unblocker/unblock.txt`

После этого в `cron.hourly` добавится скрипт, который автоматически будет узнавать актуальные ip-адреса доменов из
списка и добавлять их в список статической маршрутизации

## Что дальше

У меня работает (с), так что скорее всего ничего. Но, по-хорошему, надо добавить следующие возможности:

* настройка подключения для перенаправления (сейчас зашито Wireguard0);
* возможность указывать не только домены, но и адреса/подсети;
* настройка очистки всех существующих правил маршрутизации или только некоторых.
